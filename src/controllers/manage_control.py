'''Created on 2012-3-19@author: zongzong'''from core.basehandler import BaseHandlerfrom db.mongo import Mongoimport datetime, hashlibfrom tornado.web import authenticatedfrom views.decorators import routefrom views.decorators import role_requiredfrom models.customer import Custormerfrom models.user import User@route('/manage')class ManagerHandler(BaseHandler):    @authenticated    @role_required('/manage')    def post(self):        cname = self.get_argument("cname", None)        yname = self.current_user['_id']        status = self.get_argument("status", None)        custormers = Custormer.getCustormers(cname, status,yname)        template_values = {}        template_values['custormers'] = custormers        template_values['cname'] = cname        template_values['status'] = status        self.render_template('/site/manage.html', **template_values)    @authenticated    @role_required('/manage')    def get(self):        custormers = Custormer.getAllCustormers()        template_values = {}        template_values['custormers'] = custormers        template_values['cname'] = ' '        template_values['status'] = 0        self.render_template('/site/manage.html', **template_values)        @route('/custorm_add')class AddCustormHandler(BaseHandler):        @authenticated    @role_required('/custorm_add')    def get(self):        template_values = {}        template_values['next'] = self.get_argument('next', '/')                self.render_template('/site/custorm_add.html', **template_values)            @authenticated    @role_required('/custorm_add')    def post(self):          yname = self.get_username()        status = 0        begin_at = self.get_argument("begin_at", None)        suspended_at = self.get_argument("suspended_at", None)        description = self.get_argument("description", None)        ctype = self.get_argument("type", None)        cname = self.get_argument("cname", None)        continue_to = self.get_argument("continue_to", None) #        password = self.get_argument("password", None)                    Custormer.insertCustorm(yname, status, description, cname, begin_at, suspended_at, continue_to, ctype)               #/*signup for cusormer**/        user = User.lookup(cname)        if not user:            user = User.instance(cname, '123456', 3)            Mongo.db.ui['users'].insert(user)        #/***/        self.redirect("/manage")    @route('/manage_mod')class ModifiedCustormHandler(BaseHandler):        @authenticated    @role_required('/manage_mod')    def get(self):        _cid = self.get_argument("name", None)        status = self.get_argument("status", None)        percent = self.get_argument("percent", None)        begin_at = self.get_argument("begin_at", None)        suspended_at = self.get_argument("suspended_at", None)         Custormer.updateCustorm(status, percent, begin_at, suspended_at)          custormers = Custormer.getAllCustormers()        template_values = {}        template_values['custormers'] = custormers        self.render_template('/site/manage.html', **template_values)                            