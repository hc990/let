# -*- coding: utf-8 -*-'''Created on 2012-9-9@author: zongzong'''# Notification Originator Application (TRAP)from pyasn1.codec.ber import encoderfrom pysnmp.carrier.asynsock.dgram import udpfrom pysnmp.carrier.asynsock.dispatch import AsynsockDispatcherfrom pysnmp.entity.rfc3413.oneliner import cmdgenfrom pysnmp.proto import api, rfc1902from pysnmp.proto.rfc1902 import Gauge32import binascii#/**#Speed   (1, 3, 6, 1, 2, 1, 2, 2, 1, 5)#*/'''        get它是SNMP协议中使用率最高的一个命令，因为该命令是从网络设备中获得管理信息的基本方式           '''  def getIfPort(ip, securityName, commName):              '''        方法getCmd返回由errorIndication, errorStatus, errorIndex, varBinds组成的一个tuple        非空的errorIndication字符串指示SNMP引擎级别的错误        errorStatus和errorIndex指示SNMP的PDU级别错误（PDU-level error）。如果errorStatus等于true，表明SNMP的PDU错误由varBinds中索引为errorIndex-1的被管对象引起。        varBinds是由被管对象（Managed Objects）组成的tuple。响应中的被管对象位置与传递参数时的OID相同。每一个被管对象都是由Object Name和Object Value组成的tuple。        '''        errorIndication, errorStatus, errorIndex, varBinds = cmdgen.CommandGenerator().getCmd(        cmdgen.CommunityData(securityName, commName , 1),    #     cmdgen.UdpTransportTarget((ip, 161)),cmdgen.MibVariable('IF-MIB', 'ifSpeed',22))    #    cmdgen.UdpTransportTarget((ip, 161)),(1,3,6,1,4,1,9,2,1,55))    #     cmdgen.UdpTransportTarget((ip, 161)),(1,3,6,1,2,1,14,1))        cmdgen.UdpTransportTarget((ip, 161)),(1,3,6,1,2,1,1,1,0))    #    cmdgen.UdpTransportTarget((ip, 161)),cmdgen.MibVariable('SNMPv2-MIB', 'sysName',0))        #无用 (1.3.6.1.2.1.2.2.1.5)    #    (1, 3, 6, 1, 2, 1, 2, 2, 1, 5, 22)         if errorStatus:            print '%s at %s\n' % (errorStatus.prettyPrint(), errorIndex and varBinds[-1][int(errorIndex) - 1] or '?')    #         print(errorIndication)#         print(errorStatus)#         print varBinds               #将列表转化为字符串        vars = ",".join(str(d) for d in varBinds)#         print vars        #截取vars中的16进制的数字转化为字符串输出来          objectName = vars[12:29]        print objectName        OctetString =  vars[31:43]        TypeChange = vars[54:-3]        #将十六进制数以字符串输出        sysdescription = binascii.a2b_hex(TypeChange)        print sysdescription        return varBinds                                                                   def updateIfSpeed(ip, securityName, commName):          cg = cmdgen.CommandGenerator()         comm_data = cmdgen.CommunityData(securityName, commName)        transport = cmdgen.UdpTransportTarget((ip, 161))       #    variables = ((1, 3, 6, 1, 2, 1, 2, 2, 1, 5, 22), Gauge32(250000000))      #    variables = (cmdgen.MibVariable('SNMPv2-MIB', 'sysName',0),"junzhong")    #    variables = (cmdgen.MibVariable('IF-MIB', 'ifSpeed',22), Gauge32(1000000))         variables = (1,3,6,1,2,1,14,1,17,22,0),Gauge32(1000000)          errIndication, errStatus, errIndex, result = cg.setCmd(comm_data, transport, variables)         print errIndication        print errStatus        print errStatus.prettyPrint()        print result                    if __name__ == '__main__':    #    updateIfSpeed('192.168.11.253', 'jztech', 'jztech')        getIfPort('192.168.11.253', 'jztec', 'jztec')    #     getIfSpeed('203.94.0.1', 'hapLink-JZtest', 'hapLink-JZtest')